{"version":3,"sources":["../src/index.ts"],"sourcesContent":["/**\n * GuideScope MCP Server\n * Exposes Japanese medical guideline search prompt generation as MCP tools\n */\n\nimport { Server } from '@modelcontextprotocol/sdk/server/index.js';\nimport { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';\nimport {\n  CallToolRequestSchema,\n  ListToolsRequestSchema,\n} from '@modelcontextprotocol/sdk/types.js';\nimport {\n  generate,\n  generatePrompt,\n  generateSearchQueries,\n  TAB_PRESETS,\n  DIFFICULTY_PRESETS,\n  type GeneratePromptOptions,\n} from '@cursorversinc/guidescope';\n\n// Create MCP server\nconst server = new Server(\n  {\n    name: 'guidescope',\n    version: '1.0.0',\n  },\n  {\n    capabilities: {\n      tools: {},\n    },\n  }\n);\n\n// List available tools\nserver.setRequestHandler(ListToolsRequestSchema, async () => {\n  return {\n    tools: [\n      {\n        name: 'generate',\n        description: '医療AIガイドライン検索用のプロンプトと検索クエリを生成します',\n        inputSchema: {\n          type: 'object',\n          properties: {\n            query: {\n              type: 'string',\n              description: '探索テーマ（例：医療AIの臨床導入における安全管理）',\n            },\n            preset: {\n              type: 'string',\n              description: 'プリセット: medical-device, clinical-operation, research-ethics, generative-ai',\n              enum: TAB_PRESETS.map(p => p.id),\n            },\n            difficulty: {\n              type: 'string',\n              description: '難易度: standard（基本）, professional（詳細分析）',\n              enum: DIFFICULTY_PRESETS.map(p => p.id),\n            },\n            customKeywords: {\n              type: 'array',\n              items: { type: 'string' },\n              description: '追加の検索キーワード',\n            },\n          },\n          required: ['query'],\n        },\n      },\n      {\n        name: 'generatePrompt',\n        description: '医療AIガイドライン検索用のプロンプトのみを生成します',\n        inputSchema: {\n          type: 'object',\n          properties: {\n            query: {\n              type: 'string',\n              description: '探索テーマ',\n            },\n            preset: {\n              type: 'string',\n              description: 'プリセット',\n              enum: TAB_PRESETS.map(p => p.id),\n            },\n            difficulty: {\n              type: 'string',\n              description: '難易度',\n              enum: DIFFICULTY_PRESETS.map(p => p.id),\n            },\n          },\n          required: ['query'],\n        },\n      },\n      {\n        name: 'generateSearchQueries',\n        description: '医療AIガイドライン検索用のクエリ一覧を生成します',\n        inputSchema: {\n          type: 'object',\n          properties: {\n            query: {\n              type: 'string',\n              description: '探索テーマ',\n            },\n            preset: {\n              type: 'string',\n              description: 'プリセット',\n              enum: TAB_PRESETS.map(p => p.id),\n            },\n          },\n          required: ['query'],\n        },\n      },\n      {\n        name: 'listPresets',\n        description: '利用可能なプリセット一覧を表示します',\n        inputSchema: {\n          type: 'object',\n          properties: {},\n        },\n      },\n    ],\n  };\n});\n\n// Handle tool calls\nserver.setRequestHandler(CallToolRequestSchema, async (request) => {\n  const { name, arguments: args } = request.params;\n\n  try {\n    switch (name) {\n      case 'generate': {\n        const options: GeneratePromptOptions = {\n          query: args?.query as string,\n          preset: args?.preset as string,\n          difficulty: args?.difficulty as 'standard' | 'professional',\n          customKeywords: args?.customKeywords as string[],\n        };\n        const result = generate(options);\n        return {\n          content: [\n            {\n              type: 'text',\n              text: JSON.stringify({\n                prompt: result.prompt,\n                searchQueries: result.searchQueries,\n              }, null, 2),\n            },\n          ],\n        };\n      }\n\n      case 'generatePrompt': {\n        const options: GeneratePromptOptions = {\n          query: args?.query as string,\n          preset: args?.preset as string,\n          difficulty: args?.difficulty as 'standard' | 'professional',\n        };\n        const prompt = generatePrompt(options);\n        return {\n          content: [\n            {\n              type: 'text',\n              text: prompt,\n            },\n          ],\n        };\n      }\n\n      case 'generateSearchQueries': {\n        const options: GeneratePromptOptions = {\n          query: args?.query as string,\n          preset: args?.preset as string,\n        };\n        const queries = generateSearchQueries(options);\n        return {\n          content: [\n            {\n              type: 'text',\n              text: queries.join('\\n'),\n            },\n          ],\n        };\n      }\n\n      case 'listPresets': {\n        const presets = TAB_PRESETS.map(p => ({\n          id: p.id,\n          name: p.name,\n          categories: p.categories,\n        }));\n        const difficulties = DIFFICULTY_PRESETS.map(p => ({\n          id: p.id,\n          name: p.name,\n          description: p.description,\n          features: p.features,\n        }));\n        return {\n          content: [\n            {\n              type: 'text',\n              text: JSON.stringify({ presets, difficulties }, null, 2),\n            },\n          ],\n        };\n      }\n\n      default:\n        throw new Error(`Unknown tool: ${name}`);\n    }\n  } catch (error) {\n    return {\n      content: [\n        {\n          type: 'text',\n          text: `Error: ${error instanceof Error ? error.message : String(error)}`,\n        },\n      ],\n      isError: true,\n    };\n  }\n});\n\n// Start server\nasync function main() {\n  const transport = new StdioServerTransport();\n  await server.connect(transport);\n  console.error('GuideScope MCP server running on stdio');\n}\n\nmain().catch(console.error);\n"],"mappings":"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","names":[]}